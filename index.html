<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preguntas SCS Trabajo Social</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="data.json" type="application/json"></script>
</head>
<body>

    <h4>Preguntas SCS - C2</h4>

    <form id="formulario" class="form-check">
        <div id="pregunta-container"></div>
        <button id="responder" type="submit" class="btn btn-primary">Responder</button>
    </form>
    <button id="nueva" onclick="window.location.reload()" class="btn btn-primary d-none mx-4">Nueva</button>

    <script>

    // Array de preguntas y respuestas
    var preguntas = 
    [  

    {    
        pregunta: "1. La Constitución Española de 1978, debida a una iniciativa parlamentaria, fue elaborada y aprobada por las Cortes formadas como resultado de las Elecciones Generales del 15 de junio de 1977. De las siguientes fechas, señala la que corresponde con la publicación del citado texto en el Boletín Oficial del Estado.",
        respuestas: [    
        "A) 6 de diciembre de 1978.",
        "B) 31 de octubre de 1978.", 
        "C) 27 de diciembre de 1978.", 
        "D) 29 de diciembre de 1978."], 
        respuestaCorrecta: 3
    }
    ]


    // Función para crear el formulario de la pregunta actual
    function crearFormulario(pregunta) {
        var preguntaContainer = document.getElementById('pregunta-container');
        preguntaContainer.innerHTML = ''; // Limpiar el contenido del contenedor

        // Crear elemento de pregunta
        var preguntaElement = document.createElement('p');
        preguntaElement.textContent = pregunta.pregunta;
        preguntaContainer.appendChild(preguntaElement);

        // Crear elementos de opciones de respuesta
        const respuestasMezcladas = mezclarRespuestas(
            pregunta.respuestas,
            pregunta.respuestaCorrecta
        );

        pregunta.respuestaCorrecta = respuestasMezcladas.findIndex(r => r.esCorrecta);

        respuestasMezcladas.forEach(function(respuesta, index) {

        {
            // Numeración de las preguntas
	        const abcd = 'ABCD';
        
            var radioLabel = document.createElement('label');
            var radioInput = document.createElement('input');
            radioInput.setAttribute('class', 'form-check-input');
            radioInput.type = 'radio';
            radioInput.name = 'respuesta';
            radioInput.value = index; // Asignar el índice de la respuesta como valor
	    
	        radioLabel.setAttribute('class',' form-check-label m-3');
            radioLabel.appendChild(radioInput);
            radioLabel.id = index;
            radioLabel.appendChild(document.createTextNode(respuesta.texto));

            preguntaContainer.appendChild(radioLabel);
            preguntaContainer.appendChild(document.createElement('br'));
            };
        });
    }

    // Función para manejar el envío del formulario
    function handleSubmit(event) {
        event.preventDefault(); // Prevenir el envío por defecto del formulario

        var respuestaSeleccionada = document.querySelector('input[name="respuesta"]:checked');
        
        if (respuestaSeleccionada)
        {
            var respuestaUsuario = parseInt(respuestaSeleccionada.value); // Convertir el valor de la respuesta a entero
            verificarRespuesta(respuestaUsuario);
        } 
        else 
        {
            alert('Por favor selecciona una respuesta.');
        }
    }
    
    // Función para mezclar las respuestas
    function mezclarRespuestas(respuestas, correcta) {
    // Creamos un array de objetos para no perder la correcta
        let mezcladas = respuestas.map((texto, index) => ({
            texto,
        esCorrecta: index === correcta
        }));

        // Mezcla Fisher-Yates
        for (let i = mezcladas.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [mezcladas[i], mezcladas[j]] = [mezcladas[j], mezcladas[i]];
        }
    return mezcladas;
    }


    // Función para verificar la respuesta seleccionada por el usuario
    function verificarRespuesta(respuestaUsuario)
    {
        if (respuestaUsuario === preguntaActual.respuestaCorrecta)
        {
            // Si la respuesta es correcta, la pinta de verde
            document.getElementById(preguntaActual.respuestaCorrecta).classList.add('text-success', 'fw-bold');
        } 
        else
        {
            // Si la respuesta es incorrecta, la pinta de rojo
            document.getElementById(preguntaActual.respuestaCorrecta).classList.add('fw-bold');
            document.getElementById(respuestaUsuario).classList.add('text-danger', 'fw-bold');
        }
            // Intercambia los botones de respuesta y nueva
            document.getElementById('responder').classList.add('d-none');
            document.getElementById('nueva').classList.remove('d-none');
            
            // Pinta la respuesta de negrita
            document.getElementById(preguntaActual.respuestaCorrecta).classList.add('fw-bold');
    }

    // Obtener una pregunta aleatoria
    var preguntaActual = preguntas[Math.floor(Math.random() * preguntas.length)];

    // Crear el formulario con la pregunta actual
    crearFormulario(preguntaActual);

    // Agregar un evento de escucha para el envío del formulario
    var formulario = document.getElementById('formulario');
    formulario.addEventListener('submit', handleSubmit);
    
    document.getElementById('nueva').onclick = function()
    { 
    	// Recarga la web con una nueva pregunta
        location.reload();
    };
</script>

</body>
</html>